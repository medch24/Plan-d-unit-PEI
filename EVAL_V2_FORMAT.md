# Format d'Ã‰valuation V2 - Documentation

## ğŸ“‹ Vue d'ensemble

Cette nouvelle version de gÃ©nÃ©ration d'Ã©valuation (V2) gÃ©nÃ¨re des documents Word avec un **format structurÃ© exact** comprenant 3 tableaux distincts, conforme aux standards PEI.

## ğŸ¯ Format du Document

### Structure ComplÃ¨te

```
Nom et prÃ©nom : â€¦â€¦â€¦â€¦.â€¦â€¦. Classe: {Classe PEI}

Ã‰valuation de {MatiÃ¨re} (UnitÃ© {Titre de l'unitÃ©})
(CritÃ¨re {Lettre})
Ã‰noncÃ© de recherche : {Ã‰noncÃ©}

Tableau 1:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CritÃ¨re X    â”‚ Nom de critÃ¨re     â”‚ Note /8  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ X            â”‚ [Nom du critÃ¨re]   â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Les apprenants seront Ã©valuÃ©s sur le critÃ¨re X (Nom du critÃ¨re) et ils seront capables de :

Tableau 2 :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ CritÃ¨re X    â”‚ 1-2  â”‚ 3-4  â”‚ 5-6  â”‚ 7-8  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ i : [nom]    â”‚      â”‚      â”‚      â”‚      â”‚
â”‚ ii : [nom]   â”‚      â”‚      â”‚      â”‚      â”‚
â”‚ iii : [nom]  â”‚      â”‚      â”‚      â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜

Tableau 3 : Descripteurs de niveaux
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Niveau  â”‚ Descripteurs de niveaux                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1-2     â”‚ [Descripteur complet niveau 1-2]      â”‚
â”‚ 3-4     â”‚ [Descripteur complet niveau 3-4]      â”‚
â”‚ 5-6     â”‚ [Descripteur complet niveau 5-6]      â”‚
â”‚ 7-8     â”‚ [Descripteur complet niveau 7-8]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[PAGE SUIVANTE]

Exercices

Exercice 1 : X.i (nom du sous-critÃ¨re)
[Ã‰noncÃ© dÃ©taillÃ© de l'exercice avec consignes]

RÃ©ponse :
_________________________________________________________
_________________________________________________________
_________________________________________________________
_________________________________________________________
_________________________________________________________

Exercice 2 : X.ii (nom du sous-critÃ¨re)
[...]
```

## ğŸš€ Utilisation

### 1. Via l'API

**Endpoint:** `POST /api/generate-eval-v2`

**RequÃªte:**
```json
{
  "matiere": "Sciences",
  "classe": "PEI 1",
  "unite": {
    "titreUnite": "Les forces et le mouvement",
    "enonceDeRecherche": "Comment les forces influencent-elles le mouvement des objets?",
    "objectifs_specifiques_detailles": [
      {
        "critere": "A",
        "sous_critere": "i",
        "description": "Expliquer un problÃ¨me ou une question"
      }
    ]
  },
  "criteres": ["A"]
}
```

**RÃ©ponse:**
- Fichier Word (.docx) tÃ©lÃ©chargeable
- Content-Type: `application/vnd.openxmlformats-officedocument.wordprocessingml.document`

### 2. Via la Page de Test

AccÃ©dez Ã  `/test-eval.html` pour tester la gÃ©nÃ©ration avec une interface simple :

1. SÃ©lectionnez la matiÃ¨re
2. SÃ©lectionnez la classe
3. Entrez le titre de l'unitÃ©
4. Entrez l'Ã©noncÃ© de recherche
5. SÃ©lectionnez le critÃ¨re Ã  Ã©valuer
6. Cliquez sur "GÃ©nÃ©rer l'Ã©valuation"

Le document Word sera tÃ©lÃ©chargÃ© automatiquement.

## ğŸ”§ FonctionnalitÃ©s Techniques

### 1. GÃ©nÃ©ration Programmatique

Le document est crÃ©Ã© **programmatiquement** avec la bibliothÃ¨que `docx` (Node.js), sans utiliser de template Word prÃ©-existant. Cela permet :

- âœ… ContrÃ´le total sur la structure
- âœ… Pas de problÃ¨mes de compatibilitÃ© de templates
- âœ… FlexibilitÃ© maximale
- âœ… Format exactement comme demandÃ©

### 2. Extraction des Sous-CritÃ¨res

Les sous-critÃ¨res (i, ii, iii, iv, v) sont extraits automatiquement depuis :

1. **PrioritÃ© 1:** `objectifs_specifiques_detailles` de l'unitÃ©
2. **PrioritÃ© 2:** Parsing des descripteurs du critÃ¨re

Exemple d'extraction depuis les descripteurs :
```javascript
// Texte: "L'Ã©lÃ¨ve : i. explique un problÃ¨me ; ii. formule une hypothÃ¨se"
// Extrait: 
// {
//   "i": "explique un problÃ¨me",
//   "ii": "formule une hypothÃ¨se"
// }
```

### 3. GÃ©nÃ©ration des Exercices

#### Avec Gemini AI (si GEMINI_API_KEY disponible)
- Exercices dÃ©taillÃ©s et contextualisÃ©s
- Consignes prÃ©cises (3-5 phrases minimum)
- AdaptÃ©s au niveau et Ã  la matiÃ¨re
- Permettent d'Ã©valuer les 4 niveaux de maÃ®trise

#### Fallback (sans clÃ© API)
- Exercices gÃ©nÃ©riques basÃ©s sur les descripteurs
- Structure standardisÃ©e avec consignes de base
- Toujours utilisables par l'enseignant

### 4. Tableaux avec Bordures

Tous les tableaux ont des bordures complÃ¨tes :
- Bordures extÃ©rieures (top, bottom, left, right)
- Bordures intÃ©rieures (insideHorizontal, insideVertical)
- Style: lignes simples noires

## ğŸ“Š DiffÃ©rences avec V1

| Aspect | V1 (generate-eval.js) | V2 (generate-eval-v2.js) |
|--------|----------------------|--------------------------|
| MÃ©thode | Template Word + docxtemplater | GÃ©nÃ©ration programmatique |
| Format | Flexible selon template | **Format exact fixe** |
| Tableaux | Selon template | **3 tableaux structurÃ©s** |
| Sous-critÃ¨res | Texte formatÃ© | **Tableau dÃ©taillÃ©** |
| DÃ©pendances | pizzip, docxtemplater | **docx** |
| FlexibilitÃ© | Haute (template modifiable) | Moyenne (code modifiable) |
| ConformitÃ© | Variable | **100% conforme au format demandÃ©** |

## ğŸ¨ Personnalisation

Pour modifier le format, Ã©ditez `/api/generate-eval-v2.js` :

### Modifier les marges
```javascript
const doc = new Document({
  sections: [{
    properties: {
      page: {
        margin: {
          top: 720,    // 0.5 inch = 720 twips
          bottom: 720,
          left: 1080,  // 0.75 inch = 1080 twips
          right: 1080
        }
      }
    },
    children: sections
  }]
});
```

### Modifier les styles de texte
```javascript
new TextRun({
  text: "Mon texte",
  bold: true,
  size: 24,  // en demi-points (24 = 12pt)
  color: "000000"
})
```

### Modifier les tableaux
```javascript
new Table({
  width: { size: 100, type: WidthType.PERCENTAGE },
  borders: {
    // Personnaliser les bordures
    top: { style: BorderStyle.SINGLE, size: 1, color: "000000" }
  },
  rows: [...]
})
```

## ğŸ” DÃ©bogage

### Logs de gÃ©nÃ©ration

L'API log des informations utiles :

```
[INFO] Generate Eval V2 Request received
[INFO] GÃ©nÃ©ration pour le critÃ¨re: A
[INFO] 3 sous-critÃ¨res trouvÃ©s pour A
[INFO] GÃ©nÃ©ration des exercices avec Gemini
[INFO] CrÃ©ation du document Word...
[INFO] GÃ©nÃ©ration du buffer...
[INFO] Document gÃ©nÃ©rÃ© avec succÃ¨s, taille: 9136
```

### Test local

Utilisez le script de test :
```bash
node test-eval-v2.js
```

Cela gÃ©nÃ¨re `test_evaluation.docx` dans le rÃ©pertoire racine.

## ğŸ“¦ DÃ©pendances

### Nouvelles dÃ©pendances ajoutÃ©es

```json
{
  "docx": "^8.x.x"  // CrÃ©ation de documents Word
}
```

### Installation

```bash
npm install docx
```

## ğŸ” Variables d'Environnement

| Variable | Description | Obligatoire |
|----------|-------------|-------------|
| `GEMINI_API_KEY` | ClÃ© API Gemini pour gÃ©nÃ©ration des exercices | Non (fallback activÃ©) |

Si `GEMINI_API_KEY` n'est pas dÃ©fini, le systÃ¨me utilise des exercices par dÃ©faut basÃ©s sur les descripteurs.

## ğŸš¢ DÃ©ploiement

### Vercel

Le routing est dÃ©jÃ  configurÃ© dans `vercel.json` :

```json
{
  "rewrites": [
    { "source": "/api/generate-eval-v2", "destination": "/api/generate-eval-v2.js" }
  ]
}
```

### DÃ©ploiement manuel

```bash
vercel --prod
```

## ğŸ“ Exemples de MatiÃ¨res SupportÃ©es

- Sciences
- MathÃ©matiques
- Design
- Langue et littÃ©rature
- Acquisition de langues
- Individus et sociÃ©tÃ©s
- Arts

Tous les critÃ¨res A, B, C, D sont supportÃ©s selon la matiÃ¨re et le niveau PEI (1-5).

## ğŸ› ProblÃ¨mes Connus

### âš ï¸ Limite : Un seul critÃ¨re par gÃ©nÃ©ration

La V2 gÃ©nÃ¨re **un document par critÃ¨re**. Si vous avez besoin d'Ã©valuer plusieurs critÃ¨res, gÃ©nÃ©rez plusieurs documents.

**Raison:** Le format demandÃ© est conÃ§u pour un seul critÃ¨re Ã  la fois (Tableau 1 contient une seule ligne de donnÃ©es).

### Solution pour multiples critÃ¨res

```javascript
// GÃ©nÃ©rer un document pour chaque critÃ¨re
for (const critere of ['A', 'B', 'C']) {
  await fetch('/api/generate-eval-v2', {
    body: JSON.stringify({ 
      ...data, 
      criteres: [critere] 
    })
  });
}
```

## âœ… Validation du Format

Le document gÃ©nÃ©rÃ© respecte :

- âœ… En-tÃªte avec "Nom et prÃ©nom" et "Classe"
- âœ… Titre "Ã‰valuation de {matiÃ¨re} (UnitÃ© {titre})"
- âœ… CritÃ¨re et Ã©noncÃ© de recherche
- âœ… Tableau 1 : CritÃ¨re et note /8
- âœ… Tableau 2 : Sous-critÃ¨res avec colonnes de niveaux
- âœ… Tableau 3 : Descripteurs de niveaux (4 niveaux)
- âœ… Section Exercices sur nouvelle page
- âœ… Espaces pour rÃ©ponses

## ğŸ“ Support

Pour toute question ou problÃ¨me :

1. Consultez les logs dans la console/Vercel
2. VÃ©rifiez le fichier de test `test-eval-v2.js`
3. Ouvrez le document gÃ©nÃ©rÃ© dans Word pour validation

## ğŸ”„ Migrations depuis V1

Pour migrer depuis V1 (template-based) vers V2 (programmatic) :

1. **Pas de migration de templates nÃ©cessaire** (V2 ne les utilise pas)
2. **L'API reste compatible** : mÃªme format de requÃªte
3. **Changez l'endpoint** : `/api/generate-eval` â†’ `/api/generate-eval-v2`

V1 reste disponible si vous prÃ©fÃ©rez l'approche par template.

---

**Version:** 2.0  
**Date:** 21 Novembre 2025  
**Auteur:** GenSpark AI Developer
